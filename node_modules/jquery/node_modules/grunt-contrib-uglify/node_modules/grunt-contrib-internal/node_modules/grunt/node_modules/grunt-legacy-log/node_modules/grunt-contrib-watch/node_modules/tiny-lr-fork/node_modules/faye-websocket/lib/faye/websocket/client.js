var net = require('net'),
    tls = require('tls');

var HybiParser = require('./hybi_parser'),
    API        = require('./api'),
    Event      = require('./api/event');

var Client = function(url, protocols, options) {
  this.url  = url;
  this._uri = require('url').parse(url);

  this.protocol = '';
  this.readyState = API.CONNECTING;
  this.bufferedAmount = 0;

  var secure     = (this._uri.protocol === 'wss:'),
      self       = this,
      onConnect  = function() { self._onConnect() },
      tlsOpti