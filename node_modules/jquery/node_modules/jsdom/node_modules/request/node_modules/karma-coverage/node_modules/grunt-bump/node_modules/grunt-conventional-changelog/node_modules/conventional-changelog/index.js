'use strict';
var fs = require('fs');
var git = require('./lib/git');
var writeLog = require('./lib/writeLog');
var extend = require('lodash').assign;

function generate(options, done) {
  function getChangelogCommits() {
    git.getCommits(options, function(err, commits) {
      if (err) {
        return done('Failed to read git log.\n' + err);
      }
      writeChangelog(commits);
    });
  }

  function writeChangelog(commits) {
    options.log('Parsed %d commits.', commits.length);
    writeLog(commits